<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <link rel="icon" href="/rust-prime/images/git.png"><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>rust教程</title><meta name="description" content="一个简单的rust教程✨">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/rust-prime/assets/style.debece91.css">
    <link rel="modulepreload" href="/rust-prime/assets/app.a489c551.js"><link rel="modulepreload" href="/rust-prime/assets/ownership.html.783004ca.js"><link rel="modulepreload" href="/rust-prime/assets/ownership.html.c1874889.js"><link rel="modulepreload" href="/rust-prime/assets/plugin-vue_export-helper.21dcd24c.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/rust-prime/" class="home-link"><img class="logo" src="/rust-prime/images/git.png" alt="rust教程"><!----><span class="site-name hide-in-pad">rust教程</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/rust-prime/RustPrimer/" class="nav-link active" aria-label="rust指南"><i class="icon iconfont icon-creative"></i>rust指南<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/yzqbooks/rust-prime" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" aria-labelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" aria-labelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索文档" autocomplete="off" spellcheck="false" value><!----></form><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/rust-prime/RustPrimer/" class="nav-link sidebar-link sidebar-page" aria-label="RustPrimer"><!---->RustPrimer<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">action</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">any</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">appendix</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">attr-and-compiler-arg</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">cargo-detailed-cfg</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">cargo-projects-manager</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">closure</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">coding-style</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">collections</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">concurrency-parallel-thread</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">cover</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">data-structure</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">editors</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">error-handling</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ffi</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">flow</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">function</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">generic</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">heap-stack</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">images</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">install</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">intoborrow</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">io</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">iterator</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">macro</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">marker</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">match</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">module</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">operator-overloading</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">ownership-system</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/rust-prime/RustPrimer/ownership-system/" class="nav-link sidebar-link sidebar-page" aria-label="ownership-system"><!---->ownership-system<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="/RustPrimer/ownership-system/ownership.md"><!---->/RustPrimer/ownership-system/ownership.md<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#所有权-ownership" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="所有权（Ownership）"><!---->所有权（Ownership）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#绑定-binding" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="绑定（Binding）"><!---->绑定（Binding）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#作用域" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="作用域"><!---->作用域<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#移动语义-move" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="移动语义（move）"><!---->移动语义（move）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#copy特性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Copy特性"><!---->Copy特性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#浅拷贝与深拷贝" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="浅拷贝与深拷贝"><!---->浅拷贝与深拷贝<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#可变性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="可变性"><!---->可变性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#高级copy特性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="高级Copy特性"><!---->高级Copy特性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#高级move" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="高级move"><!---->高级move<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/rust-prime/RustPrimer/ownership-system/borrowing_reference.html" class="nav-link sidebar-link sidebar-page" aria-label="引用&amp;借用（References&amp;Borrowing）"><!---->引用&amp;借用（References&amp;Borrowing）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rust-prime/RustPrimer/ownership-system/preface.html" class="nav-link sidebar-link sidebar-page" aria-label="所有权系统"><!---->所有权系统<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rust-prime/RustPrimer/ownership-system/lifetime.html" class="nav-link sidebar-link sidebar-page" aria-label="生命周期（ Lifetime ）"><!---->生命周期（ Lifetime ）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">quickstart</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">rcarc</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">safe</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">src</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">std</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><a href="/rust-prime/RustPrimer/SUMMARY.html" class="nav-link sidebar-link sidebar-page" aria-label="Summary"><!---->Summary<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">testing</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">trait</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">type</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">unsafe-rawpointer</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">关于rust</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><a href="/rust-prime/RustPrimer/TOC.html" class="nav-link sidebar-link sidebar-page" aria-label="目录"><!---->目录<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!----></h1><div class="page-info"><!----><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" aria-labelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年5月2日</span><meta property="datePublished" content="2022-05-02T18:39:38.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" aria-labelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>大约 11 分钟</span><meta property="timeRequired" content="PT11M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#所有权-ownership" class="router-link-active router-link-exact-active toc-link level2">所有权（Ownership）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#绑定-binding" class="router-link-active router-link-exact-active toc-link level3">绑定（Binding）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#作用域" class="router-link-active router-link-exact-active toc-link level3">作用域</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#移动语义-move" class="router-link-active router-link-exact-active toc-link level3">移动语义（move）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#copy特性" class="router-link-active router-link-exact-active toc-link level3">Copy特性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#浅拷贝与深拷贝" class="router-link-active router-link-exact-active toc-link level3">浅拷贝与深拷贝</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#可变性" class="router-link-active router-link-exact-active toc-link level3">可变性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#高级copy特性" class="router-link-active router-link-exact-active toc-link level3">高级Copy特性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rust-prime/RustPrimer/ownership-system/ownership.html#高级move" class="router-link-active router-link-exact-active toc-link level3">高级move</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h2 id="所有权-ownership" tabindex="-1"><a class="header-anchor" href="#所有权-ownership" aria-hidden="true">#</a> <strong>所有权（Ownership）</strong></h2><p>在进入正题之前，大家先回忆下一般的编程语言知识。 对于一般的编程语言，通常会先声明一个变量，然后初始化它。 例如在C语言中：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>          <span class="token comment">// 变量a的作用域开始</span>
    a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token string">&quot;xyz&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 变量c的作用域开始</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>                   <span class="token comment">// 变量a和c的作用域结束</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>尽管可以编译通过，但这是一段非常糟糕的代码，现实中我相信大家都不会这么去写。变量a和c都是局部变量，函数结束后将局部变量a的地址返回，但局部变量<code>a</code>存在栈中，在离开作用域后，局部变量所申请的栈上内存都会被系统回收，从而造成了<code>Dangling Pointer</code>的问题。<strong>这是一个非常典型的内存安全问题。很多编程语言都存在类似这样的内存安全问题</strong>。再来看变量<code>c</code>，<code>c</code>的值是常量字符串，存储于常量区，可能这个函数我们只调用了一次，我们可能不再想使用这个字符串，但<code>xyz</code>只有当整个程序结束后系统才能回收这片内存，这点让程序员是不是也很无奈？</p><blockquote><p>备注：对于<code>xyz</code>，可根据实际情况，通过堆的方式，手动管理（申请和释放）内存。</p></blockquote><p>所以，内存安全和内存管理通常是程序员眼中的两大头疼问题。令人兴奋的是，Rust却不再让你担心内存安全问题，也不用再操心内存管理的麻烦，那Rust是如何做到这一点的？请往下看。</p><h3 id="绑定-binding" tabindex="-1"><a class="header-anchor" href="#绑定-binding" aria-hidden="true">#</a> <strong>绑定（Binding）</strong></h3><p><strong>重要</strong>：首先必须强调下，准确地说Rust中并没有变量这一概念，而应该称为<code>标识符</code>，目标<code>资源</code>(内存，存放value)<code>绑定</code>到这个<code>标识符</code>：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">;</span>       <span class="token comment">// 标识符x, 没有绑定任何资源</span>
    <span class="token keyword">let</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 标识符y，绑定资源100</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>好了，我们继续看下以下一段Rust代码：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面定义了一个i32类型的标识符<code>a</code>，如果你直接<code>println!</code>，你会收到一个error报错：</p><blockquote><p>error: use of possibly uninitialized variable: <code>a</code></p></blockquote><p>这是<strong>因为Rust并不会像其他语言一样可以为变量默认初始化值，Rust明确规定变量的初始值必须由程序员自己决定</strong>。</p><p>正确的做法：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">;</span>
    a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">//必须初始化a</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其实，<strong><code>let</code><strong>关键字并不只是声明变量的意思，它还有一层特殊且重要的概念-<strong>绑定</strong>。通俗的讲，<code>let</code>关键字可以把一个标识符和一段内存区域做“绑定”，绑定后，这段内存就被这个标识符所拥有，这个标识符也成为这段内存的唯一</strong>所有者</strong>。 所以，<code>a = 100</code>发生了这么几个动作，首先在栈内存上分配一个<code>i32</code>的资源，并填充值<code>100</code>，随后，把这个资源与<code>a</code>做绑定，让<code>a</code>成为资源的所有者(Owner)。</p><h3 id="作用域" tabindex="-1"><a class="header-anchor" href="#作用域" aria-hidden="true">#</a> <strong>作用域</strong></h3><p>像C语言一样，Rust通过<code>{}</code>大括号定义作用域：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>编译后会得到如下<code>error</code>错误：</p><blockquote><p>b.rs:3:20: 3:21 error: unresolved name <code>a</code> [E0425] b.rs:3 println!(&quot;{}&quot;, a);</p></blockquote><p>像C语言一样，在局部变量离开作用域后，变量随即会被销毁；<strong>但不同是，Rust会连同变量绑定的内存，不管是否为常量字符串，连同所有者变量一起被销毁释放</strong>。所以上面的例子，a销毁后再次访问a就会提示无法找到变量<code>a</code>的错误。这些所有的一切都是在编译过程中完成的。</p><h3 id="移动语义-move" tabindex="-1"><a class="header-anchor" href="#移动语义-move" aria-hidden="true">#</a> <strong>移动语义（move）</strong></h3><p>先看如下代码：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>编译后会得到如下的报错：</p><blockquote><p>c.rs:4:20: 4:21 error: use of moved value: <code>a</code> [E0382] c.rs:4 println!(&quot;{}&quot;, a);</p></blockquote><p>错误的意思是在<code>println</code>中访问了被<code>moved</code>的变量<code>a</code>。那为什么会有这种报错呢？具体含义是什么？ 在Rust中，和“绑定”概念相辅相成的另一个机制就是“转移move所有权”，意思是，<strong>可以把资源的所有权(ownership)从一个绑定转移（move）成另一个绑定</strong>，这个操作同样通过<code>let</code>关键字完成，和绑定不同的是，<code>=</code>两边的左值和右值均为两个标识符：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>语法：
    <span class="token keyword">let</span> 标识符<span class="token class-name">A</span> <span class="token operator">=</span> 标识符<span class="token class-name">B</span><span class="token punctuation">;</span>  <span class="token comment">// 把“B”绑定资源的所有权转移给“A”</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>move前后的内存示意如下：</p><blockquote><p><strong>Before move:</strong><br> a &lt;=&gt; 内存(地址：<strong>A</strong>，内容：&quot;xyz&quot;)<br><strong>After move:</strong><br> a<br> b &lt;=&gt; 内存(地址：<strong>A</strong>，内容：&quot;xyz&quot;)</p></blockquote><p>被move的变量不可以继续被使用。否则提示错误<code>error: use of moved value</code>。</p><p>这里有些人可能会疑问，move后，如果变量A和变量B离开作用域，所对应的内存会不会造成“Double Free”的问题？答案是否定的，<strong>Rust规定，只有资源的所有者销毁后才释放内存，而无论这个资源是否被多次<code>move</code>，同一时刻只有一个<code>owner</code>，所以该资源的内存也只会被<code>free</code>一次</strong>。 通过这个机制，就保证了内存安全。是不是觉得很强大？</p><h3 id="copy特性" tabindex="-1"><a class="header-anchor" href="#copy特性" aria-hidden="true">#</a> <strong>Copy特性</strong></h3><p>有读者仿照“move”小节中的例子写了下面一个例子，然后说“a被move后是可以访问的”：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>编译确实可以通过，输出为<code>100</code>。这是为什么呢，是不是跟move小节里的结论相悖了？ 其实不然，这其实是根据变量类型是否实现<code>Copy</code>特性决定的。对于实现<code>Copy</code>特性的变量，在move时会拷贝资源到新内存区域，并把新内存区域的资源<code>binding</code>为<code>b</code>。</p><blockquote><p><strong>Before move:</strong><br> a &lt;=&gt; 内存(地址：<strong>A</strong>，内容：100)<br><strong>After move:</strong><br> a &lt;=&gt; 内存(地址：<strong>A</strong>，内容：100)<br> b &lt;=&gt; 内存(地址：<strong>B</strong>，内容：100)</p></blockquote><p>move前后的<code>a</code>和<code>b</code>对应资源内存的地址不同。</p><p>在Rust中，基本数据类型(Primitive Types)均实现了Copy特性，包括i8, i16, i32, i64, usize, u8, u16, u32, u64, f32, f64, (), bool, char等等。其他支持Copy的数据类型可以参考官方文档的<a href="https://doc.rust-lang.org/std/marker/trait.Copy.html" title="Copy Trait" target="_blank" rel="noopener noreferrer">Copy章节<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h3 id="浅拷贝与深拷贝" tabindex="-1"><a class="header-anchor" href="#浅拷贝与深拷贝" aria-hidden="true">#</a> <strong>浅拷贝与深拷贝</strong></h3><p>前面例子中move String和i32用法的差异，其实和很多面向对象编程语言中“浅拷贝”和“深拷贝”的区别类似。对于基本数据类型来说，“深拷贝”和“浅拷贝“产生的效果相同。对于引用对象类型来说，”浅拷贝“更像仅仅拷贝了对象的内存地址。 如果我们想实现对<code>String</code>的”深拷贝“怎么办？ 可以直接调用<code>String</code>的Clone特性实现对内存的值拷贝而不是简单的地址拷贝。</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &lt;-注意此处的clone</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这个时候可以编译通过，并且成功打印&quot;xyz&quot;。</p><p>clone后的效果等同如下：</p><blockquote><p><strong>Before move:</strong><br> a &lt;=&gt; 内存(地址：<strong>A</strong>，内容：&quot;xyz&quot;)<br><strong>After move:</strong><br> a &lt;=&gt; 内存(地址：<strong>A</strong>，内容：&quot;xyz&quot;)<br> b &lt;=&gt; 内存(地址：<strong>B</strong>，内容：&quot;xyz&quot;)<br> 注意，然后a和b对应的资源值相同，但是内存地址并不一样。</p></blockquote><h3 id="可变性" tabindex="-1"><a class="header-anchor" href="#可变性" aria-hidden="true">#</a> <strong>可变性</strong></h3><p>通过上面，我们已经已经了解了变量声明、值绑定、以及移动move语义等等相关知识，但是还没有进行过修改变量值这么简单的操作，在其他语言中看似简单到不值得一提的事却在Rust中暗藏玄机。 按照其他编程语言思维，修改一个变量的值：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>很抱歉，这么简单的操作依然还会报错：</p><blockquote><p>error: re-assignment of immutable variable <code>a</code> [E0384] <code>&lt;anon&gt;</code>:3 a = 200;</p></blockquote><p>不能对<strong>不可变绑定</strong>赋值。如果要修改值，必须用关键字mut声明绑定为可变的：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>  <span class="token comment">// 通过关键字mut声明a是可变的</span>
a <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>想到“不可变”我们第一时间想到了<code>const</code>常量，但不可变绑定与<code>const</code>常量是完全不同的两种概念；首先，“不可变”准确地应该称为“不可变绑定”，是用来约束绑定行为的，“不可变绑定”后不能通过原“所有者”更改资源内容。</strong></p><p><strong>例如：</strong></p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//不可变绑定, a &lt;=&gt; 内存区域A(1,2,3)</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> a <span class="token operator">=</span> a<span class="token punctuation">;</span>  <span class="token comment">//可变绑定， a &lt;=&gt; 内存区域A(1,2,3), 注意此a已非上句a，只是名字一样而已</span>
a<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//打印：[1, 2, 3, 4]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>“可变绑定”后，目标内存还是同一块，只不过，可以通过新绑定的a去修改这片内存了。</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//可变绑定, a &lt;=&gt; 内存区域A(&quot;abc&quot;)</span>
a <span class="token operator">=</span> <span class="token string">&quot;xyz&quot;</span><span class="token punctuation">;</span>    <span class="token comment">//绑定到另一内存区域, a &lt;=&gt; 内存区域B(&quot;xyz&quot;)</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//打印：&quot;xyz&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面这种情况不要混淆了，<code>a = &quot;xyz&quot;</code>表示<code>a</code>绑定目标资源发生了变化。</p><p>其实，Rust中也有const常量，常量不存在“绑定”之说，和其他语言的常量含义相同：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">const</span> <span class="token constant">PI</span><span class="token punctuation">:</span><span class="token keyword">f32</span> <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可变性的目的就是严格区分绑定的可变性，以便编译器可以更好的优化，也提高了内存安全性。</p><h3 id="高级copy特性" tabindex="-1"><a class="header-anchor" href="#高级copy特性" aria-hidden="true">#</a> <strong>高级Copy特性</strong></h3><p>在前面的小节有简单了解Copy特性，接下来我们来深入了解下这个特性。 Copy特性定义在标准库<a href="https://doc.rust-lang.org/std/marker/trait.Copy.html" target="_blank" rel="noopener noreferrer">std::marker::Copy<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Copy</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>一旦一种类型实现了Copy特性，这就意味着这种类型可以通过的简单的位(bits)拷贝实现拷贝。从前面知识我们知道“绑定”存在move语义（所有权转移），但是，一旦这种类型实现了Copy特性，会先拷贝内容到新内存区域，然后把新内存区域和这个标识符做绑定。</p><p><strong>哪些情况下我们自定义的类型（如某个Struct等）可以实现Copy特性？</strong> 只要这种类型的属性类型都实现了Copy特性，那么这个类型就可以实现Copy特性。 例如：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span> <span class="token punctuation">{</span>  <span class="token comment">//可实现Copy特性</span>
    a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Bar</span> <span class="token punctuation">{</span>  <span class="token comment">//不可实现Copy特性</span>
    l<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>因为<code>Foo</code>的属性<code>a</code>和<code>b</code>的类型<code>i32</code>和<code>bool</code>均实现了<code>Copy</code>特性，所以<code>Foo</code>也是可以实现Copy特性的。但对于<code>Bar</code>来说，它的属性<code>l</code>是<code>Vec&lt;T&gt;</code>类型，这种类型并没有实现<code>Copy</code>特性，所以<code>Bar</code>也是无法实现<code>Copy</code>特性的。</p><p><strong>那么我们如何来实现<code>Copy</code>特性呢？</strong> 有两种方式可以实现。</p><ol><li><p><strong>通过<code>derive</code>让Rust编译器自动实现</strong></p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Copy, Clone)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>编译器会自动检查<code>Foo</code>的所有属性是否实现了<code>Copy</code>特性，一旦检查通过，便会为<code>Foo</code>自动实现<code>Copy</code>特性。</p></li><li><p><strong>手动实现<code>Clone</code>和<code>Copy</code> trait</strong></p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">impl</span> <span class="token class-name">Copy</span> <span class="token keyword">for</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">impl</span> <span class="token class-name">Clone</span> <span class="token keyword">for</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token class-name">Foo</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>b<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>
    y<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//打印：Foo { a: 100, b: true }</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//打印：Foo { a: 100, b: false }</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>从结果我们发现<code>let mut y = x</code>后，<code>x</code>并没有因为所有权<code>move</code>而出现不可访问错误。 因为<code>Foo</code>继承了<code>Copy</code>特性和<code>Clone</code>特性，所以例子中我们实现了这两个特性。</p></li></ol><h3 id="高级move" tabindex="-1"><a class="header-anchor" href="#高级move" aria-hidden="true">#</a> <strong>高级move</strong></h3><p>我们从前面的小节了解到，<code>let</code>绑定会发生所有权转移的情况，但<code>ownership</code>转移却因为资源类型是否实现<code>Copy</code>特性而行为不同：</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token class-name">T</span> <span class="token operator">=</span> something<span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>类型<code>T</code>没有实现<code>Copy</code>特性：<code>x</code>所有权转移到<code>y</code>。</li><li>类型<code>T</code>实现了<code>Copy</code>特性：拷贝<code>x</code>所绑定的<code>资源</code>为<code>新资源</code>，并把<code>新资源</code>的所有权绑定给<code>y</code>，<code>x</code>依然拥有原资源的所有权。</li></ul><h5 id="move关键字" tabindex="-1"><a class="header-anchor" href="#move关键字" aria-hidden="true">#</a> <strong>move关键字</strong></h5><p>move关键字常用在闭包中，强制闭包获取所有权。</p><p><strong>例子1：</strong></p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
 <span class="token keyword">let</span> some_closure <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>i<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token closure-punctuation punctuation">|</span></span> i <span class="token operator">+</span> x<span class="token punctuation">;</span>
 <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">some_closure</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x={}, y={}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>结果： x=100, y=102</p></blockquote><p>注意: 例子1是比较特别的，使不使用 move 对结果都没什么影响，因为<code>x</code>绑定的资源是<code>i32</code>类型，属于 <code>primitive type</code>，实现了 <code>Copy trait</code>，所以在闭包使用 <code>move</code> 的时候，是先 copy 了<code>x</code> ，在 move 的时候是 move 了这份 clone 的 <code>x</code>，所以后面的 <code>println!</code>引用 <code>x</code> 的时候没有报错。</p><p><strong>例子2：</strong></p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> <span class="token keyword">mut</span> x<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">let</span> <span class="token keyword">mut</span> some_closure <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token punctuation">:</span> <span class="token keyword">char</span><span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">some_closure</span><span class="token punctuation">(</span><span class="token char">&#39;d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x={:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p><strong>报错：</strong></p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>error: use of moved value: `x` [E0382]
&lt;anon&gt;:5  println!(&quot;x={:?}&quot;, x);
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这是因为move关键字，会把闭包中的外部变量的所有权move到包体内，发生了所有权转移的问题，所以<code>println</code>访问<code>x</code>会如上错误。如果我们去掉<code>println</code>就可以编译通过。</p><p>那么，如果我们想在包体外依然访问x，即x不失去所有权，怎么办？</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> <span class="token keyword">mut</span> x<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">{</span>
     <span class="token keyword">let</span> <span class="token keyword">mut</span> some_closure <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token punctuation">:</span> <span class="token keyword">char</span><span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">some_closure</span><span class="token punctuation">(</span><span class="token char">&#39;d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x={:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//成功打印：x=&quot;abcd&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们只是去掉了move，去掉move后，包体内就会对<code>x</code>进行了<strong>可变借用</strong>，而不是“剥夺”<code>x</code>的所有权，细心的同学还注意到我们在前后还加了<code>{}</code>大括号作用域，是为了作用域结束后让<strong>可变借用</strong>失效，这样<code>println</code>才可以成功访问并打印我们期待的内容。</p><p>关于“<strong>Borrowing借用</strong>”知识我们会在下一个大节中详细讲解。</p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/yzqbooks/rust-prime/edit/main/docs/RustPrimer/ownership-system/ownership.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" aria-labelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/5/2 19:09:36</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: yzqdev@outlook.com">yzqdev</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/rust-prime/RustPrimer/ownership-system/" class="nav-link active prev" aria-label="ownership-system"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->ownership-system</div></a><a href="/rust-prime/RustPrimer/ownership-system/borrowing_reference.html" class="nav-link next" aria-label="引用&amp;借用（References&amp;Borrowing）"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">引用&amp;借用（References&amp;Borrowing）<!----></div></a></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer">powered by <a href='https://vuepress-theme-hope.github.io/v2/'>vuepress-theme-home</a></div><!----></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/rust-prime/assets/app.a489c551.js" defer></script>
  </body>
</html>
